############################################
 #  Home assistant maintanance automations  #
 ############################################

 #Pull config when travis build succedeed
  - id: pull_config
    alias: HA - Pull config when Travis build succeded
    trigger:
    - platform: state
      entity_id: binary_sensor.travis_status
      to: 'on'
    action:
    - service: shell_command.pull_git_conf
    - delay: '00:00:10'
    - service: script.ifttt_notify
      data_template:
        message: "HA pulled config"
    - service: homeassistant.restart

# Restart mopidy service every hour when it's no playing
  - id: restart_mopidy
    alias: Mopidy - Restart mopidy service 
    trigger:
    - platform: time
      minutes: 00
      seconds: 00
    condition:
      condition: or
      conditions:
      - condition: state
        entity_id: 'media_player.salon'
        state: 'off'
      - condition: state
        entity_id: 'media_player.salon'
        state: 'paused'      
    action:
    - service: shell_command.restart_mopidy