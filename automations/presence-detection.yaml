###############################################
#  Set input boolean if user at home or away  #
###############################################

# Away home
  - id: away
    alias: Presence - turn off boolean when leaving home
    trigger:
    - platform: state
      entity_id: device_tracker.google_maps_102169435937546415265
      to: 'not_home'
    - platform: state
      entity_id: device_tracker.google_maps_102169435937546415265
      to: 'extended home'
      for: '00:00:30'
      # condition:
      #   - condition: state
      #     entity_id: device_tracker.nexus
      #     state: 'not_home'
    action:
      - service: input_boolean.turn_off
        data:
          entity_id: input_boolean.michal_home
      - service: input_select.select_option
        data:
          entity_id: input_select.michal_status
          option: 'away'

# At home
  - id: at_home
    alias: Presence - turn on boolean when at home
    trigger:
      - platform: state
        entity_id: device_tracker.google_maps_102169435937546415265
        to: 'home'
      - platform: state
        entity_id: device_tracker.nexus
        to: 'home'
    action:
      - service: input_boolean.turn_on
        data:
          entity_id: input_boolean.michal_home
      - service: input_select.select_option
        data:
          entity_id: input_select.michal_status
          option: 'at home'

# Extended home
  - id: extended_home
    alias: Presence - extended home
    trigger:
      platform: numeric_state
      entity_id: proximity.home
      below: 5
      above: 0
    condition:
      condition: and
      conditions:
        # Heading home
        - condition: template
          value_template: '{{ states.proximity.home.attributes.dir_of_travel == "towards" }}'

        # # Michal away home
        # - condition: state
        #   entity_id: input_select.michal_status
        #   state: 'away'
    action:
      - service: input_select.select_option
        data:
          entity_id: input_select.michal_status
          option: 'near home'
      - service: script.ifttt_notify
        data_template:
          message: "HA: zbli≈ºasz sie do domu"