##############################
#  Notification automations  #
##############################

# Notify when outside temperature sensor is dead
  # - id: temperature_sensor_battery_dead
  #   alias: Notification - temperature sensor is not sending data
  #   trigger:
  #     platform: mqtt
  #     topic: 'outside/temperature'
  #   action:
  #     - service: homeassistant.turn_off
  #       data:
  #         entity_id: script.notify_temperature_dead
  #     - delay: '00:00:10'
  #     - service: homeassistant.turn_on
  #       data:
  #         entity_id: script.notify_temperature_dead

# Notify when new home assistant version is live
- id: update_notification
  alias: Notification - HA update available
  trigger:
    - platform: state
      entity_id: updater.updater
    - platform: state
      entity_id: input_boolean.michal_home
      from: 'off'
      to: 'on'
      for:
        minutes: 15
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_boolean.michal_home
        state: 'on'
      - condition: template
        value_template: "{{states.updater.updater.state[-1] | int > 0}}"
  action:
    - service: notify.michal_html
      data:
        title: "HA dostępna aktualizacja"
        message: "Nowa wersja Home Assistant: {{ states('updater.updater') }}"
        data:
          actions:
            - action: update_ha
              title: Update (dangerous)
    - service: persistent_notification.create
      data:
        title: "Dostępna aktualizacja"
        message: "Nowa wersja Home Assistant: {{ states('updater.updater') }} - {{ as_timestamp(now()) | timestamp_custom('%I:%M:%S %p %d%b%Y', true) }}"
        notification_id: "update_available"

# Notify when HA started
- id: ha_start
  alias: Notification - HA started
  trigger:
    - platform: homeassistant
      event: start
  # condition:
  #   - condition: state
  #     entity_id: input_boolean.michal_home
  #     state: 'off'
  action:
    - service: notify.michal_html
      data:
        message: "Home assistant wystartował"

# Notify when HA shutdown
- id: ha_shutdown
  alias: Notification - HA shutdown
  trigger:
    - platform: homeassistant
      event: shutdown
  condition:
    - condition: state
      entity_id: input_boolean.michal_home
      state: 'off'
  action:
    - service: notify.michal_html
      data:
        message: "Home assistant wyłącza się"