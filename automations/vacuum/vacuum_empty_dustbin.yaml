- id: vacuum_empty_dustbin
  alias: Vacuum - empty dustbin
  trigger:
    - platform: state
      entity_id: input_boolean.michal_home
      from: 'off'
      to: 'on'
      for:
        minutes: 10
    - platform: state
      entity_id: input_boolean.vacuum_finished
      from: 'off'
      to: 'on'
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: "{{ as_timestamp(state_attr('automation.vacuum_empty_dustbin','last_triggered'))|timestamp_custom('%Y-%m-%d') != as_timestamp(now())|timestamp_custom('%Y-%m-%d') }}"
      - condition: state
        entity_id: input_boolean.vacuum_finished
        state: 'on'
      - condition: time
        weekday:
          - sat
      - condition: state
        entity_id: input_boolean.michal_home
        state: 'on'
      - condition: state
        entity_id: input_boolean.guest_mode
        state: 'off'
      - condition: or
        conditions:
          - condition: state
            entity_id: vacuum.xiaomi_vacuum_cleaner
            state: 'idle'
          - condition: state
            entity_id: vacuum.xiaomi_vacuum_cleaner
            state: 'docked'
  action:
    - service: script.vacuum_goto_bin
    - delay: '00:01:15'
    - service: script.turn_on
      entity_id: script.say
      data:
        variables:
          volume: '1'
          what: 'Czas wypróżnić odkurzacz'