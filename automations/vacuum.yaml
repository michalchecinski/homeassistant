  - id: vacuum_on
    alias: Vacuum - on
    trigger:
      - platform: state
        entity_id: binary_sensor.event_hour_offset
        to: 'on'
      - platform: state
        entity_id: input_select.michal_home
        to: 'off'
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: binary_sensor.event_hour_offset
          state: 'on'
        - condition: state
          entity_id: input_select.michal_status
          state: 'away'
        - condition: or
          conditions:
          - condition: template
            value_template: '{{ as_timestamp(now()) - as_timestamp(states.automation.vacuum__on.attributes.last_triggered) | int > 43200 }}'
          - condition: state
            entity_id: input_boolean.vacuum_finished
            state: 'off'
        - condition: time
          after: '07:40:00'
          before: '20:00:00'
    action:
    - service: input_boolean.turn_off
      data_template:
        entity_id: input_boolean.vacuum_finished
    - service: script.ifttt_notify
      data_template:
        message: "Vacuum on"
    - service: homeassistant.turn_on
      data_template:
        entity_id: script.vacuum_start


  - id: vacuum_off
    alias: Vacuum - off
    trigger:
      - platform: state
        entity_id: input_select.michal_home
        to: 'on'
    action:
    - service: script.ifttt_notify
      data_template:
        message: "Vacuum off"
    - service: homeassistant.turn_off
      data_template:
        entity_id: script.vacuum_start

  - id: vacuum_finished
    alias: Vacuum - finished
    trigger:
      - platform: state
        entity_id: script.vacuum_start
        to: 'off'
    condition:
      - condition: template
        value_template: '{{ as_timestamp(now()) - as_timestamp(states.automation.vacuum__off.attributes.last_triggered) | int > 30 }}'
    action:
    - service: input_boolean.turn_on
      data_template:
        entity_id: input_boolean.vacuum_finished
    - service: script.ifttt_notify
      data_template:
        message: "Vacuum finished"

  - id: vacuum_finished_off
    alias: Vacuum - finished input bool to off
    trigger:
      - platform: time
        at: '00:01:00'
    action:
      - service: input_boolean.turn_off
        data_template:
          entity_id: input_boolean.vacuum_finished